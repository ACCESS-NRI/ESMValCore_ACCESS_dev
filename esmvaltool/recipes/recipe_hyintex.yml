# recipe_hyint.yml
---

documentation:
  description: |
    Recipe for the HyInt package by E. Arnone and J. von Hardenberg (ISAC-CNR)

  authors:
    - arno_en
    - hard_jo

  references:
    - giorgi11jc
    - giorgi14jgr

  projects:
    - c3s-magic

datasets:
  - {dataset: ACCESS1-0,      project: CMIP5, exp: [historical,rcp85], ensemble: r1i1p1, start_year: 2004, end_year: 2006}
#  - {dataset: ACCESS1-3,      project: CMIP5, exp: rcp85, ensemble: r1i1p1, start_year: 2006, end_year: 2016}
#  - {dataset: MPI-ESM-MR,      project: CMIP5, exp: rcp85, ensemble: r1i1p1, start_year: 2006, end_year: 2016}

preprocessors:
  preproc:
    extract_levels: false

diagnostics:
  hyint:
    description: HyInt hydroclimatic indices calculation and plotting
    variables:
       pr:
        preprocessor: preproc
        reference_dataset: "ACCESS1-0"
        mip: day
        field: T2Ds
    scripts:
      main:
        script: hyint/hyint.R
        # Define whether model data should be regridded 
        # a) false to keep original resolution
        # b) set desired regridding resolution in cdo format e.g., "r320x160"
        # c) "REF" to use resolution of reference model
        rgrid: false   
        # Reference normalization period to be used for normalized indices 
        norm_years: [2004,2006]

        # Select type of plot:
        # 1) lon/lat maps per individual field/exp/multi-year mean
        # 2) lon/lat maps per individual field/exp-ref-diff/multi-year mean
        # 3) lon/lat maps multi-field/exp-ref-diff/multi-year mean
        # 4) lon/lat maps multifield/exp/multiyear - skipped if using multi-year mean
        # 11) timeseries over required individual region/exp
        # 12) timeseries over multiple regions/exp
        # 13) timeseries with multiple models
        # 14) summary trend coefficients multiple regions
        # 15) summary trend coefficients multiple models
        # plot_type: [2, 3, 12, 13, 14, 15]
        plot_type: [14]
        # Select single plot or multi-panel figure
        multipanel: false
        # Select number of columns and rows in multi-panel figure
        npancol: 2 # number of columns for trend/tseries multi-panel figures
        npanrow: 3 # number of rows for trend/tseries multi-panel figures  

        # Select regions for timeseries and maps from the following list
        # 1=World, 2=World60 (60S/60N),3=Tropics (30S/30N), 4=South America, 
        # 5=Africa,6=Northi,7=America,8=India,9=Europe,10=East-Asia,
        # 11=Australia
        selregions: [2,4,5,6,7]

     
        # Call preprocessing for ETCCDI indices calculated with climdex
        etccdi_preproc: true

        # Specify external path to repository of ETCCDI indices 
        # (unless these are calculated in the same directory)
        etccdi_dir <- ""

     
        # Select one or more fields for timeseries and maps from the following 
        # list (order-sensitive): 
        # SDII, DSL, WSL, HY-INT, ABS_INT, ABS_DSL, ABS_WSL, PA, R95, 
        # "altcddETCCDI", "altcsdiETCCDI", "altcwdETCCDI",
        # "altwsdiETCCDI", "cddETCCDI", "csdiETCCDI", "cwdETCCDI",
        # "dtrETCCDI", "fdETCCDI", "gslETCCDI", "idETCCDI",
        # "prcptotETCCDI", "r10mmETCCDI", "r1mmETCCDI", "r20mmETCCDI",
        # "r95pETCCDI", "r99pETCCDI", "rx1dayETCCDI", "rx5dayETCCDI",
        # "sdiiETCCDI", "suETCCDI", "tn10pETCCDI", "tn90pETCCDI",
        # "tnnETCCDI", "tnxETCCDI", "trETCCDI", "tx10pETCCDI",
        # "tx90pETCCDI", "txnETCCDI", "txxETCCDI", "wsdiETCCDI"
        selfields: [8, 4, 1, 9, 3, 2]

       # Select automated or pre-set range of values in plots
        autolevels: true       
       

        ## ------- Advanced settings ----------
        # data
        removedesert: false  # T to remove (flag as NA) grid points with mean 
                             # annual pr < 0.5 mm/day (deserts, Giorgi2014)
        masksealand: false # T to mask depending on seaLandElevation threshold
        sealandelevation: 0 # a) 0 land; b) positive value: land above given
                        # elevation; c) negative value: sea below given depth.
                        # The topography/bathymetry file is generated with cdo 
                        # from ETOPO data. 
        reverse_masksealand: false # T to reject what selected,
                                   #  F to keep what selected

        # maps
        oplot_grid: false           # plot grid points over maps
        map_continents: -2   # thickness of continents:
                             # positive values in white, negative values in gray
        map_continents_regions: false # plot also regional boundaries
        ryearplot: 2006  # years to be plotted for experiments
                         # (maps over individual years): 
                         # a) actual years, b) "FIRST" = first year in dataset or 
                         # c) "ALL"  = all years in dataset. E.g., c(1998,2000,2005)   
        rmultiyear_mean: true # plot multiyear mean (this override ryearplot)
 

        # timeseries and trends
        weight_tseries: true  # adopt area weights in timeseries
        trend_years: false    # (a) F=all; (b) c(year1,year2) to apply trend 
                              # calculation and plotting only to a limited 
                              # time interval (year1<=years<=year2) 
                              # c) c(year1,year2,year3,year4) to apply trend to
                              # two separate time intervals (year1<=y's<=year2) 
                              # and (year3<=y's<=year4)
      
        lm_trend: true              # calculate linear trend
        add_trend: true             # add linear trend to plot
        add_trend_sd: false         # add stdev range to timeseries
        add_trend_sd_shade: false   # add shade of stdev range to timeseries
        add_tseries_lines: true     # lot lines of timeseries over points
        add_zeroline: true          # plot a dashed line at y=0
        trend_years_only: false     # limit timeseries plotting to trend_years
                                    # time interval
        scale100years: true         # plot trends as 1/100 years
        scalepercent: false         # plot trends as % change (excluding hyint) 
        oplot_grid: false           # plot grid points over maps
        
        topography_highres: "~/work/data/Elevation/GMTED2010_15n030_0125deg.nc"
        boxregion: false # !=0 plot region boxes over global maps with 
                         # thickness = abs(boxregion); white (>0) or grey (<0).  

