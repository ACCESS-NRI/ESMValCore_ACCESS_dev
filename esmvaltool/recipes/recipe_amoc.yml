###############################################################################
# recipe_amoc.yml

documentation:
  description:
    Recipe to produce time series figures of the derived variable, the
    Atlantic meriodinal overturning circulation (AMOC).
    This recipe also produces transect figures of the stream functions for
    the years 2001-2004.

  authors:
    - ledm

  references:
    - BGC-val:gmd-2018-103, https://doi.org/10.5194/gmd-11-4215-2018, 2018.

  projects:
    - ukesm


datasets:
     - {dataset: CanESM2,          project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CCSM4,            project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CESM1-BGC,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CESM1-CAM5-1-FV2, project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CESM1-CAM5,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CESM1-FASTCHEM,   project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CESM1-WACCM,      project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CNRM-CM5-2,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: CNRM-CM5,         project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: FGOALS-g2,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: MIROC5,           project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: MPI-ESM-LR,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: MPI-ESM-MR,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: MPI-ESM-P,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: MRI-CGCM3,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: MRI-ESM1,         project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: NorESM1-ME,       project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}
     - {dataset: NorESM1-M,        project: CMIP5,    exp: historical,  ensemble: r1i1p1,  start_year: 1860,  end_year: 2004}


preprocessors:

  prep_timeseries:
    custom_order: true

  prep_transect:
    custom_order: true
    extract_time:
      start_year: 2001
      start_month: 1
      start_day: 1
      end_year: 2003
      end_month: 12
      end_day: 31
    time_average:

diagnostics:
  # --------------------------------------------------
  # Time series diagnostics
  # --------------------------------------------------
  diag_timeseries:
    description: atlantic_meridional_overturning_circulation
    variables:
      amoc:
        preprocessor: prep_timeseries
        field: TOM
        mip: Omon
        derive: true
        force_derivation: false
    scripts:
      Regional_Ocean_Surface_mean_timeseries:
        script: ocean/diagnostic_timeseries.py
        moving_average: 6 years

  # --------------------------------------------------
  # Transect diagnostics
  # --------------------------------------------------
  diag_transects:
    description: Global Ocean transects
    variables:
      msftmyz:
        preprocessor: prep_transect
        field: TO2M
        mip: Omon
    scripts:
      Global_Ocean_surface_map:
        script: ocean/diagnostic_transects.py
        thresholds: [-20, -10., 0., 10., 20.]
        set_y_logscale: False
