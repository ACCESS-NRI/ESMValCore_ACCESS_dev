# recipe_rainfarm.yml
---

documentation:
  description: |
    Recipe for performing stochastic downscaling of precipitation fields
    calling the RainFARM package by J. von Hardenberg (ISAC-CNR)
  authors:
    - arno_en
    - hard_jo

  references:
    - donofrio14jh
    - rebora06jhm
    - terzago18nhess

  projects:
    - c3s-magic

datasets:
  - {dataset: EC-EARTH,       project: CMIP5, exp: historical, ensemble: r1i1p1, start_year: 1997, end_year: 1997}

preprocessors:
  preproc:
    extract_region:    
      # The selected region needs to have equal and even number of longitude 
      # and latitude grid points (e.g., 2x2, 4x4, ...). 
      # Warning: downcaling can reach very high resolution so select a limited area.
      start_longitude: 3
      end_longitude: 13
      start_latitude: 43
      end_latitude: 53
    regrid:
      target_grid: 1x1  # in degrees, can also be the name of one of the datasets to use the grid from that dataset
      scheme: linear  # can be linear, nearest, area_weighted, unstructured_nearest
diagnostics:
  rainfarm:
    description: RainFARM stochastic downscaling of precipitation fields
    variables:
      pr:
        preprocessor: preproc
        reference_dataset: "EC-EARTH"
        mip: day
        field: T2Ds
    scripts:
      rainfarm:
        script: rainfarm/rainfarm.R
        # RainFARM options 
        # Note - RainFARM usage:  rfarm [-s SLOPE] [-e NENS] [-n NF] [-r REGION] [-w WEIGHTS]
        #                               [-o OUTFILE] [-v VARNAME] [-g] [-c]
        # NOTE: for more information type 'rfarm -h' from terminal
        slope: 1.7             # spatial spectral slope       
        nens: 2                # number of ensemble members to be calculated
        nf: 8                  # subdivisions for downscaling
        varname: false         # input variable name - this is assigned by ESMValTool pre-processing 
        conserv_glob: true     # conserve precipitation over full domain
        conserv_smooth: true   # conserve precipitation using convolution
        # orographic weights: set false or climatology file to be used (calling rfweights) 
        weights_climo: false

